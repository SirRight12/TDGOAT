var Movement=pc.createScript("movement");class paC{constructor(t,e,o,s=!1){this.x=t,this.z=e,this.isStart=s,this.yD=o}normalize(){return new pc.Vec3(this.x+xStart,yPos,this.z+zStart)}entityPosition(){const t=this.normalize();return new pc.Vec3(t.x,t.y,t.z)}calcDist(){const t=new pc.Vec3(this.x,0,this.z);let e=t.clone();this.next&&(e=new pc.Vec3(this.next.x,0,this.next.z));return e.sub(t).clone()}}function wholeNum(t){return Math.abs(t.x)+Math.abs(t.y)+Math.abs(t.z)}const pathCoords=[new paC(-3,0,90,!0),new paC(1,0,90),new paC(1,1,90),new paC(1,2,90),new paC(1,3,90),new paC(1,4,90),new paC(1,5,90),new paC(1,6,90),new paC(1,7,180),new paC(2,7,180),new paC(3,7,180),new paC(4,7,180),new paC(5,7,-90),new paC(5,6,-90),new paC(5,5,-90),new paC(5,4,180),new paC(6,4,180),new paC(7,4,180),new paC(8,4,180)];let startTile;for(let t=0;t<pathCoords.length;t++){const e=pathCoords[t];e.isStart&&(startTile=e),e.next=pathCoords[t+1]||!1}let trackLength=0;for(let t=0;t<pathCoords.length;t++){const e=pathCoords[t];trackLength+=Math.abs(wholeNum(e.calcDist()))}Movement.prototype.initialize=function(){this.planes=[];const t=this.app.assets.getAssetById(155879098),e=this.app.assets.getAssetById(155879093);for(let s=xStart;s<=widthSeg;s++)for(let a=zStart;a<=lengthSeg;a++){let n=!1;const i=new pc.Vec3(s,yPos,a);pathCoords.forEach((t=>{if(t.normalize().equals(i))return n=!0,void t.isStart}));var o=new pc.Entity;let r=t;if(n&&(r=e),o.addComponent("model",{type:"plane",materialAsset:r}),o.addComponent("collision",{halfExtend:new pc.Vec3(.4,0,.4)}),!n){o.isPlaceable=!0,o.canPlaceTower=!0;const t=this.app.root;o.placeTower=function(e){return!!this.canPlaceTower&&(this.canPlaceTower=!1,this.tower=e.clone(),this.tower.enabled=!0,cash<this.tower.cost&&(this.tower.destroy(),delete this.tower),this.tower.tile=this,this.tower.setPosition(this.getPosition()),t.addChild(this.tower),this.tower)},o.sellTower=function(t=!0){if(this.canPlaceTower)return!1;this.canPlaceTower=!0,t&&(cash+=.7*this.tower.cost),this.tower.destroy(),delete this.tower}}o.setLocalPosition(s,yPos,a),o.setLocalScale(1,1,1),this.app.root.addChild(o)}};const length=8,width=8,xStart=-4,zStart=-4,yPos=0,widthSeg=xStart+8,lengthSeg=zStart+8;Movement.prototype.update=function(t){};var FollowPath=pc.createScript("followPath");function enemyIn(t){baseHealth-=t.health,t.health=0,t.onDead(),t.text.destroy(),t.destroy(),baseHealth<=0&&location.reload()}const radDegNum=180/Math.PI;function d2r(t){return t/Math.PI}function r2d(t){return t*radDegNum}let baseHealth=10;FollowPath.attributes.add("Health",{type:"number",max:200,min:1,step:1}),FollowPath.attributes.add("Speed",{type:"number",max:10,min:1,step:1}),FollowPath.prototype.initialize=function(){this.startTile=startTile,this.entity.maxHealth=this.Health,this.entity.isEnemy=!0,this.entity.health=this.entity.maxHealth,this.currentTile=startTile,this.addedDist=0,this.entity.elapsedDist=0;const t=this;this.walkSpeed=this.Speed,this.entity.children.forEach((e=>{"EColDetection"!=e.name||(t.entity.colDetect=e)})),this.nextTile=function(){this.currentTile=this.currentTile.next||!1;const t=new pc.Quat;return t.setFromEulerAngles(0,this.currentTile.yD,0),this.entity.setLocalRotation(t),this.currentTile.next?(this.entity.setLocalPosition(this.currentTile.entityPosition()),!0):(enemyIn(this.entity),!1)},this.nextTile()},FollowPath.prototype.update=function(t){this.entity.colDetect.rigidbody.teleport(this.entity.getLocalPosition(),new pc.Quat);let e=this.entity.getLocalPosition(),i=this.currentTile.calcDist();const s=t*this.walkSpeed;i.mulScalar(s);let n=e.add(i).clone();if(this.addedDist+=wholeNum(i),this.entity.elapsedDist+=Math.abs(wholeNum(i)),Math.abs(this.addedDist)>=wholeNum(this.currentTile.calcDist())){this.addedDist=0,this.nextTile(),e=this.entity.getLocalPosition();try{i=this.currentTile.calcDist()}catch{return}i.mulScalar(s),n=e.add(i).clone(),this.addedDist+=wholeNum(i),this.entity.elapsedDist+=Math.abs(wholeNum(i))}this.entity.setLocalPosition(n)};var Click=pc.createScript("click");let towerToPlace;Click.prototype.initialize=function(){this.app.mouse.on("mousedown",this.onEntityClick,this),this.delay=!1,towerToPlace=this.app.root.findByName("Scout Basic")},Click.prototype.update=function(t){},Click.prototype.onEntityClick=function(t){t.buttons[0]&&this.setRaycast(t)},Click.prototype.setRaycast=function(t){const e=this.entity.getPosition().clone(),i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),o=this.app.systems.rigidbody.raycastFirst(e,i);if(o)if(o.entity.isTower&&t.shiftKey)o.entity.tile.sellTower();else{if(o.entity.isPlaceable){if(t.shiftKey)return void o.entity.sellTower();if(!towerToPlace)return;const e=o.entity.placeTower(towerToPlace);if(e){if(cash<e.cost)return void o.entity.sellTower(!1);cash-=e.cost}}o.entity.health&&(o.entity.health-=1,o.entity.health<=0&&(o.entity.text.destroy(),o.entity.destroy()))}};var Follow=pc.createScript("follow");Follow.prototype.initialize=function(){const t=this.app.root.findByName("Screen"),e=this.app.root.findByName("Textism");this.entity.text=e.clone(),this.entity.text.enabled=!0,this.entity.text.element.text=this.entity.health+"/"+this.entity.maxHealth,t.addChild(this.entity.text)},Follow.prototype.update=function(t){if(this.entity.health<=0)return;const e=this.entity.getPosition();this.entity.text.setPosition(e.x+.15,e.y+1.2,e.z),this.entity.text.element.text=this.entity.health+"/"+this.entity.maxHealth};var GoUp=pc.createScript("goUp");GoUp.prototype.initialize=function(){},GoUp.prototype.update=function(p){};var GoDown=pc.createScript("goDown");GoDown.prototype.initialize=function(){},GoDown.prototype.update=function(o){};var Waves=pc.createScript("waves");Waves.attributes.add("difficulty",{type:"string",placeholder:"easy"}),Waves.attributes.add("text",{type:"entity"}),Waves.attributes.add("advice",{type:"entity"});const wave1={enemies:4,delay:250};let waveController;Waves.prototype.initialize=function(){const e={easy:[{enemies:4,delay:250,bonus:0,advice:"place scout"},{enemies:8,advice:"place at least 2 scouts",delay:250,bonus:50},{enemies:[{name:"Basic Enemy",count:5},{name:"Speedy Enemy",count:3}],advice:"Warning: Speedy enemies inbound",delay:250,bonus:100},{enemies:[{name:"Basic Enemy",count:3},{name:"Speedy Enemy",count:6}],delay:250,bonus:100},{enemies:[{name:"Slow Enemy",count:3},{name:"Basic Enemy",count:3},{name:"Speedy Enemy",count:4}],advice:"Sniper does big damage",delay:250,bonus:100},{enemies:[{name:"Slow Enemy",count:5},{name:"Speedy Enemy",count:3}],delay:250,bonus:100},{enemies:16,delay:250,bonus:100},{enemies:18,delay:250,bonus:100}],medium:{},hard:{}}[this.difficulty.toLowerCase().replace(" ","")];let t=this.app;this.pressKey=function(e){return this.app.keyboard.isPressed(e)};class Enemy{constructor(e=!1){this.isEnemy=!0,this.type=e||"Basic Enemy";const n=t.assets.find(this.type).resource.instantiate();this.entity=n}}const n=this;class Wave{constructor(e=1,t=0){this.delay=t,console.log("wave"),this.enemies=[],e[0]?this.constructEnemyList(e):this.makeNumbers(e)}async makeNumbers(e){for(let t=0;t<e;t++)this.enemies.push(new Enemy(!1));this.addEnemies()}async constructEnemyList(e){for(let t=0;t<e.length;t++){const n=e[t],s=n.name;for(let e=0;e<n.count;e++)this.enemies.push(new Enemy(s))}this.addEnemies()}addEnemies(){for(let e=0;e<this.enemies.length;e++){const n=this.enemies[e].entity;setTimeout((()=>{n.enabled=!0,n.onDead=function(){waveController.enemiesAlive-=1,waveController.checkNextWave()},t.root.addChild(n)}),this.delay*e)}}}waveController=new class WaveController{constructor(e=100){this.wave=-1,this.waveDelay=e,this.isFirstWave=!0,this.enemiesAlive=0,this.nextWave()}nextWave(){if(this.wave++,n.text.enabled=!0,!e[this.wave]){this.wave--,n.text.element.text="VECTORY!";const e=[n.app.root.findByName("Units"),n.app.root.findByName("Cash"),n.app.root.findByName("Up/Down")];for(let t=0;t<e.length;t++)e[t].enabled=!1;return n.advice.enabled=!0,void(n.advice.element.text="(you win)")}this.isFirstWave?this.isFirstWave=!1:n.text.element.text=`Wave ${this.wave} Completed!`,e[this.wave].advice&&(n.advice.enabled=!0,n.advice.element.text=e[this.wave].advice),console.log("starting wave");const t=this;setTimeout((()=>{n.text.enabled=!1,n.advice.enabled=!1,t.enemiesAlive=0;for(let n=0;n<e[t.wave].enemies.length;n++){const s=e[t.wave].enemies[n];t.enemiesAlive+=s.count}console.log(e[t.wave].enemies),t.enemiesAlive||(t.enemiesAlive=e[t.wave].enemies),console.log(t.enemiesAlive),cash+=e[t.wave].bonus||0,new Wave(e[t.wave].enemies,e[t.wave].delay)}),this.waveDelay)}checkNextWave(){this.enemiesAlive<=0&&this.nextWave()}}(2e3)},Waves.prototype.update=function(e){};var TowerInit=pc.createScript("towerInit");TowerInit.attributes.add("xTan",{type:"number",max:1,min:-1,step:2}),TowerInit.attributes.add("zTan",{type:"number",max:1,min:-1,step:2}),TowerInit.attributes.add("animLength",{type:"number",max:5,min:0,placeholder:.16}),TowerInit.prototype.initialize=function(){this.entity.isTower=!0,this.canAttack=!0,this.entity.rangeDict={length:0},this.entity.children[1].collision.radius=this.entity.range||1,this.entity.targeting="first"},Array.prototype.numSortHL=function(){return this.sort((function(t,e){return e-t})),this},Array.prototype.numSortLH=function(){return this.sort((function(t,e){return t-e})),this},TowerInit.prototype.update=function(t){if(!this.entity)return;if(this.entity.children[1].collision.radius=this.entity.aRange||1,this.entity.rangeDict.length<1)return void(this.entity.anim.parameters.Idle.value=!0);const e=[],i={},n=[],a={},r=[],s=[];let h,o=0;for(let t in this.entity.rangeDict){const h=this.entity.rangeDict[t];if(!h.isEnemy)continue;if(h.health<=0){delete this.entity.rangeDict[t],this.entity.rangeDict.length-=1;continue}const c=this.entity.getPosition(),u=h.getPosition(),l=c.x,y=u.x,m=c.z,g=u.z,p=Math.sqrt((m-g)**2+(l-y)**2);e.push(p),i[p]=h;const d=h.elapsedDist/trackLength*100;n.push(d),a[d]=h;let f=h.health;s[f]&&(o++,f+=""+o),r.push(f),s[f]=h}if(0===e.length)return this.entity.anim.parameters.Attacking.value=!1,void(this.entity.anim.parameters.Idle.value=!0);switch(this.entity.anim.parameters.Idle.value=!1,this.entity.targeting){case"first":n.numSortHL(),h=a[n[0]];break;case"last":n.numSortLH(),h=a[n[0]];break;case"close":e.numSortLH(),h=i[e[0]];break;case"far":e.numSortHL(),h=i[e[0]];break;case"WeakCurrent":r.numSortLH(),h=s(r[0])}var c=new pc.Vec3;c.sub2(h.getPosition(),this.entity.getPosition());var u=new pc.Quat;const l=Math.atan2(c.z*this.zTan,c.x*this.xTan)*pc.math.RAD_TO_DEG;if(u.setFromEulerAngles(0,l,0),this.entity.setLocalRotation(u),!this.canAttack)return;this.entity.anim.parameters.Attacking.value=!0,setTimeout((()=>{this.entity.anim.parameters.Reloading.value=!0,this.entity.anim.baseLayer.activeStateCurrentTime=0}),1e3*this.animLength);let y=h.health;h.health-=this.entity.damage||0,h.health<0&&(h.health=0);let m=y-h.health;cash+=m||0,this.canAttack=!1,setTimeout((()=>{this.entity.anim.parameters.Reloading.value=!1,this.canAttack=!0,this.entity.anim.baseLayer.activeStateCurrentTime=0}),1e3*this.entity.attackDelay||1/0),h.health<=0&&(h.onDead(),delete this.entity.rangeDict[h._guid],h.text.destroy(),h.destroy())};var RangeParent=pc.createScript("range");RangeParent.prototype.initialize=function(){this.entity.collision.on("triggerenter",(function(t){t.wasTouched=!0,this.entity.parent.rangeDict[t.parent._guid]=t.parent,this.entity.parent.rangeDict.length+=1}),this),this.entity.collision.on("triggerleave",(function(t){t.wasTouched=!1;const e=this.entity.parent;t.parent&&(e.rangeDict[t.parent._guid]&&delete e.rangeDict[t.parent._guid],e.rangeDict.length-=1)}),this)},RangeParent.prototype.update=function(t){};var Cash=pc.createScript("cash");Cash.prototype.initialize=function(){};let cash=200;Cash.prototype.update=function(t){this.entity.element.text=`Cash: $${cash}`};var ScoutInit=pc.createScript("scoutInit");ScoutInit.attributes.add("Damage",{type:"number",max:999,min:0,step:1}),ScoutInit.attributes.add("Range",{type:"number",max:10,min:0,step:1}),ScoutInit.attributes.add("AttackSpeed",{type:"number",max:5,min:0,step:1}),ScoutInit.attributes.add("Price",{type:"number",max:1e3,min:100,step:50}),ScoutInit.prototype.initialize=function(){this.entity.damage=this.Damage||1,this.entity.attackDelay=this.AttackSpeed||0,this.entity.cost=this.Price||100,this.entity.aRange=this.Range||1},ScoutInit.prototype.update=function(t){};var TowerSelect=pc.createScript("towerSelect");let towerSelected="scout";TowerSelect.prototype.initialize=function(){this.sniper=this.app.root.findByName("Sniper"),this.scout=this.app.root.findByName("Scout Basic"),this.minigun=this.app.root.findByName("mini"),this.railgunner=this.app.root.findByName("Railgunner"),console.log(this.railgunner),this.selected="scout",this.pressKey=function(e){return this.app.keyboard.isPressed(e)}},TowerSelect.prototype.update=function(e){this.pressKey(pc.KEY_1)&&"scout"!=this.selected?(towerToPlace=this.scout,this.selected="scout",towerSelected="scout"):this.pressKey(pc.KEY_2)&&"sniper"!=this.selected?(towerToPlace=this.sniper,this.selected="sniper",towerSelected="sniper"):this.pressKey(pc.KEY_3)&&"railgunner"!=this.selected?(towerToPlace=this.railgunner,this.selected="railgunner",towerSelected="railgunner"):this.pressKey(pc.KEY_4)&&"minigun"!=this.selected&&(towerToPlace=this.minigun,this.selected="minigun",towerSelected="minigun")};var TextGlow=pc.createScript("textGlow");TextGlow.attributes.add("contains",{type:"string"}),TextGlow.prototype.initialize=function(){},TextGlow.prototype.update=function(t){this.contains==towerSelected?this.entity.element.color=pc.Color.YELLOW:this.entity.element.color=pc.Color.WHITE};